define("local_assign_ai/review_progress",["exports","core/ajax","core/notification","core/str"],(function(_exports,_ajax,_notification,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Polls backend for progress of AI reviews and updates UI accordingly.
   *
   * @module     local_assign_ai/review_progress
   * @copyright  2025 Wilber Narvaez <https://datacurso.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(cmid){reflectHeaderButtonsState();const initialDelay=document.body.classList.contains("assign-ai-progress-running")?0:8e3;setTimeout((()=>{poll(),intervalid=setInterval(poll,8e3)}),initialDelay)},_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);let intervalid=0;function reflectHeaderButtonsState(){const anyInProgress=document.querySelector("tr.js-row-inprogress"),btnReviewAll=document.querySelector(".js-review-all"),btnApproveAll=document.querySelector(".js-approve-all");btnReviewAll&&(btnReviewAll.disabled=!!anyInProgress||btnReviewAll.disabled),btnApproveAll&&(anyInProgress?btnApproveAll.setAttribute("disabled","disabled"):"1"===btnApproveAll.dataset.enableonidle&&btnApproveAll.removeAttribute("disabled"))}function applyProgress(entries){entries.forEach((entry=>{const row=document.querySelector('tr[data-pendingid="'+entry.id+'"]');row&&(row.setAttribute("data-progress",String(entry.progress)),function(row,progress,status){const badge=row.querySelector(".js-state-badge"),hint=row.querySelector(".js-state-hint");let indicator=row.querySelector(".js-progress-indicator");if(progress>0&&progress<100){var _row$querySelector;row.classList.add("js-row-inprogress"),indicator||(indicator=document.createElement("div"),indicator.className="small text-warning js-progress-indicator",indicator.innerHTML='<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>',null===(_row$querySelector=row.querySelector("td:nth-child(7)"))||void 0===_row$querySelector||_row$querySelector.appendChild(indicator)),(0,_str.get_string)("processing","local_assign_ai").then((txt=>{indicator.innerHTML='<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>'+txt+" ("+progress+"%)"})).catch((()=>{})),row.querySelectorAll("button").forEach((b=>b.setAttribute("disabled","disabled")))}else row.classList.remove("js-row-inprogress"),indicator&&indicator.remove(),"initial"===status?row.querySelectorAll(".js-review-ai").forEach((b=>b.removeAttribute("disabled"))):"pending"===status?row.querySelectorAll(".view-details").forEach((b=>b.removeAttribute("disabled"))):row.querySelectorAll("button").forEach((b=>b.removeAttribute("disabled")));badge&&hint&&("initial"===status?badge.className="badge bg-secondary js-state-badge":"pending"===status&&(badge.className="badge bg-info js-state-badge"))}(row,entry.progress,entry.status))})),reflectHeaderButtonsState()}function poll(){const ids=function(){const rows=document.querySelectorAll("tr[data-pendingid]"),ids=[];return rows.forEach((row=>{const pid=parseInt(row.getAttribute("data-pendingid"),10),progress=parseInt(row.getAttribute("data-progress")||"0",10);pid&&progress<100&&ids.push(pid)})),ids}();if(0===ids.length)return clearInterval(intervalid),void reflectHeaderButtonsState();_ajax.default.call([{methodname:"local_assign_ai_get_progress",args:{pendingids:ids}}])[0].done((result=>{applyProgress(result)})).fail((err=>{_notification.default.exception(err)}))}}));

//# sourceMappingURL=review_progress.min.js.map