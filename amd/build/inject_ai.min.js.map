{"version":3,"file":"inject_ai.min.js","sources":["../src/inject_ai.js"],"sourcesContent":["import Ajax from 'core/ajax';\nimport Notification from 'core/notification';\n\nexport const init = (token) => {\n    if (!token) {\n        return;\n    }\n\n    Ajax.call([{\n        methodname: 'local_assign_ai_get_details',\n        args: { token: token },\n    }])[0].done(data => {\n        const message = data.message;\n\n        const injectMessage = () => {\n            // Buscar el textarea de feedback\n            const textarea = document.querySelector('#id_assignfeedbackcomments_editor, textarea[id^=\"id_feedbackcomments_\"]');\n\n            if (!textarea) {\n                return false;\n            }\n\n            // Insertar texto plano\n            textarea.value = message;\n\n            // ðŸ”¹ TinyMCE\n            if (window.tinymce && window.tinymce.get(textarea.id)) {\n                window.tinymce.get(textarea.id).setContent(message);\n                return true;\n            }\n\n            // ðŸ”¹ Atto\n            if (window.M && window.M.editor_atto && window.M.editor_atto.getEditorForElement) {\n                const editor = window.M.editor_atto.getEditorForElement(textarea);\n                if (editor) {\n                    editor.setHTML(message);\n                    return true;\n                }\n            }\n\n            return false;\n        };\n\n        let attempts = 0;\n        const interval = setInterval(() => {\n            attempts++;\n            if (injectMessage() || attempts > 20) {\n                clearInterval(interval);\n            }\n        }, 500);\n    }).fail(Notification.exception);\n};\n"],"names":["token","call","methodname","args","done","data","message","attempts","interval","setInterval","textarea","document","querySelector","value","window","tinymce","get","id","setContent","M","editor_atto","getEditorForElement","editor","setHTML","injectMessage","clearInterval","fail","Notification","exception"],"mappings":"4XAGqBA,QACZA,qBAIAC,KAAK,CAAC,CACPC,WAAY,8BACZC,KAAM,CAAEH,MAAOA,UACf,GAAGI,MAAKC,aACFC,QAAUD,KAAKC,YA+BjBC,SAAW,QACTC,SAAWC,aAAY,KACzBF,YA/BkB,YAEZG,SAAWC,SAASC,cAAc,+EAEnCF,gBACM,KAIXA,SAASG,MAAQP,QAGbQ,OAAOC,SAAWD,OAAOC,QAAQC,IAAIN,SAASO,WAC9CH,OAAOC,QAAQC,IAAIN,SAASO,IAAIC,WAAWZ,UACpC,KAIPQ,OAAOK,GAAKL,OAAOK,EAAEC,aAAeN,OAAOK,EAAEC,YAAYC,oBAAqB,OACxEC,OAASR,OAAOK,EAAEC,YAAYC,oBAAoBX,aACpDY,cACAA,OAAOC,QAAQjB,UACR,SAIR,GAMHkB,IAAmBjB,SAAW,KAC9BkB,cAAcjB,YAEnB,QACJkB,KAAKC,sBAAaC"}