define("local_assign_ai/review",["exports","core/modal_factory","core/modal_events","core/ajax","core/notification","editor_tiny/loader","editor_tiny/editor","core/templates","core/str"],(function(_exports,_modal_factory,_modal_events,_ajax,_notification,_loader,TinyEditor,_templates,_str){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Modal for reviewing AI-generated comments (Mustache-based).
   *
   * @module      local_assign_ai/review
   * @copyright   2025 Datacurso
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),TinyEditor=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(TinyEditor),_templates=_interopRequireDefault(_templates);_exports.init=()=>{document.querySelectorAll(".view-details").forEach((btn=>{btn.addEventListener("click",(e=>{const courseid=parseInt(e.currentTarget.dataset.courseid,10),cmid=parseInt(e.currentTarget.dataset.cmid,10),userid=parseInt(e.currentTarget.dataset.userid,10);_ajax.default.call([{methodname:"local_assign_ai_get_details",args:{courseid:courseid,cmid:cmid,userid:userid}}])[0].done((async data=>{const[title,saveLabel,saveApproveLabel]=await Promise.all([(0,_str.get_string)("modaltitle","local_assign_ai"),(0,_str.get_string)("save","local_assign_ai"),(0,_str.get_string)("saveapprove","local_assign_ai")]),bodyHtml=await _templates.default.render("local_assign_ai/review_modal",{message:data.message||"",courseid:courseid,cmid:cmid,userid:userid,savelabel:saveLabel,saveapprovelabel:saveApproveLabel}),modal=await _modal_factory.default.create({type:_modal_factory.default.types.DEFAULT,title:title,body:bodyHtml,large:!0});modal.show();const root=modal.getRoot(),textarea=root.find("#airesponse-edit")[0];let tinymce;try{var _base$menubar,_base$plugins,_base$toolbar;tinymce=await(0,_loader.getTinyMCE)();const base=TinyEditor.getStandardConfig?TinyEditor.getStandardConfig():{};await tinymce.init({...base,target:textarea,menubar:null!==(_base$menubar=base.menubar)&&void 0!==_base$menubar&&_base$menubar,plugins:null!==(_base$plugins=base.plugins)&&void 0!==_base$plugins?_base$plugins:"lists link table code",toolbar:null!==(_base$toolbar=base.toolbar)&&void 0!==_base$toolbar?_base$toolbar:"undo redo | bold italic underline | bullist numlist | link | removeformat | code"})}catch(err){}const getContent=()=>{const inst=tinymce&&tinymce.get(textarea.id);return inst?inst.getContent():textarea.value};root.on("click",".save-ai",(e=>{e.preventDefault();const newMessage=getContent();_ajax.default.call([{methodname:"local_assign_ai_update_response",args:{courseid:courseid,cmid:cmid,userid:userid,message:newMessage}}])[0].done((()=>location.reload())).fail(_notification.default.exception)})),root.on("click",".approve-ai",(e=>{e.preventDefault();const newMessage=getContent();_ajax.default.call([{methodname:"local_assign_ai_update_response",args:{courseid:courseid,cmid:cmid,userid:userid,message:newMessage}}])[0].done((()=>{_ajax.default.call([{methodname:"local_assign_ai_change_status",args:{courseid:courseid,cmid:cmid,userid:userid,action:"approve"}}])[0].done((()=>location.reload())).fail(_notification.default.exception)})).fail(_notification.default.exception)})),root.on("click",".reject-ai",(e=>{e.preventDefault(),_ajax.default.call([{methodname:"local_assign_ai_change_status",args:{courseid:courseid,cmid:cmid,userid:userid,action:"rejected"}}])[0].done((()=>location.reload())).fail(_notification.default.exception)})),root.on(_modal_events.default.hidden,(()=>{const inst=tinymce&&tinymce.get(textarea.id);inst&&inst.remove()}))})).fail(_notification.default.exception)}))}))}}));

//# sourceMappingURL=review.min.js.map