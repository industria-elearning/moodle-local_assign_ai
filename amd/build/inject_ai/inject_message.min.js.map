{"version":3,"file":"inject_message.min.js","sources":["../../src/inject_ai/inject_message.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Injects AI feedback into the grading editor.\n *\n * @module      local_assign_ai/inject_ai/inject_message\n * @copyright   2025 Datacurso\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Injects AI message into feedback editor.\n *\n * @param {string} message The message to inject.\n * @param {{root?: Element|Document}} options Injection options.\n * @returns {boolean} True if message was injected successfully\n */\nexport const injectMessage = (message, options = {}) => {\n    if (!message) {\n        return false;\n    }\n\n    const root = options.root || document;\n    const targetUserid = options.targetUserid ? parseInt(options.targetUserid, 10) : 0;\n    const candidates = Array.from(root.querySelectorAll(\n        '#id_assignfeedbackcomments_editor, textarea[id^=\"id_feedbackcomments_\"]'\n    ));\n\n    const filtered = candidates.filter((el) => {\n        if (!targetUserid) {\n            return true;\n        }\n        const form = el.closest('form');\n        if (!form) {\n            return true;\n        }\n        const userinput = form.querySelector('input[name=\"userid\"]');\n        if (!userinput) {\n            return true;\n        }\n        return parseInt(userinput.value, 10) === targetUserid;\n    });\n\n    const textarea = filtered.find(el => el && (el.offsetParent !== null || el.getClientRects().length > 0))\n        || filtered[0]\n        || candidates[0];\n\n    if (!textarea) {\n        return false;\n    }\n\n    if (textarea.value === message) {\n        return true;\n    }\n\n    textarea.value = message;\n\n    // TinyMCE support\n    if (window.tinymce && window.tinymce.get(textarea.id)) {\n        window.tinymce.get(textarea.id).setContent(message);\n        return true;\n    }\n\n    // Atto support\n    if (window.M && window.M.editor_atto && window.M.editor_atto.getEditorForElement) {\n        const editor = window.M.editor_atto.getEditorForElement(textarea);\n        if (editor) {\n            editor.setHTML(message);\n            return true;\n        }\n    }\n\n    return true;\n};\n"],"names":["message","options","root","document","targetUserid","parseInt","candidates","Array","from","querySelectorAll","filtered","filter","el","form","closest","userinput","querySelector","value","textarea","find","offsetParent","getClientRects","length","window","tinymce","get","id","setContent","M","editor_atto","getEditorForElement","editor","setHTML"],"mappings":"+LA8B6B,SAACA,aAASC,+DAAU,OACxCD,eACM,QAGLE,KAAOD,QAAQC,MAAQC,SACvBC,aAAeH,QAAQG,aAAeC,SAASJ,QAAQG,aAAc,IAAM,EAC3EE,WAAaC,MAAMC,KAAKN,KAAKO,iBAC/B,4EAGEC,SAAWJ,WAAWK,QAAQC,SAC3BR,oBACM,QAELS,KAAOD,GAAGE,QAAQ,YACnBD,YACM,QAELE,UAAYF,KAAKG,cAAc,+BAChCD,WAGEV,SAASU,UAAUE,MAAO,MAAQb,gBAGvCc,SAAWR,SAASS,MAAKP,IAAMA,KAA2B,OAApBA,GAAGQ,cAAyBR,GAAGS,iBAAiBC,OAAS,MAC9FZ,SAAS,IACTJ,WAAW,OAEbY,gBACM,KAGPA,SAASD,QAAUjB,eACZ,KAGXkB,SAASD,MAAQjB,QAGbuB,OAAOC,SAAWD,OAAOC,QAAQC,IAAIP,SAASQ,WAC9CH,OAAOC,QAAQC,IAAIP,SAASQ,IAAIC,WAAW3B,UACpC,KAIPuB,OAAOK,GAAKL,OAAOK,EAAEC,aAAeN,OAAOK,EAAEC,YAAYC,oBAAqB,OACxEC,OAASR,OAAOK,EAAEC,YAAYC,oBAAoBZ,aACpDa,cACAA,OAAOC,QAAQhC,UACR,SAIR"}