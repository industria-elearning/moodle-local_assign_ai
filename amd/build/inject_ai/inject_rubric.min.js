define("local_assign_ai/inject_ai/inject_rubric",["exports","core/notification","./normalize_string"],(function(_exports,_notification,_normalize_string){var obj;
/**
   * Injects rubric selections and comments.
   *
   * @module      local_assign_ai/inject_ai/inject_rubric
   * @copyright   2025 Datacurso
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.injectRubric=void 0,_notification=(obj=_notification)&&obj.__esModule?obj:{default:obj};_exports.injectRubric=function(rubricData,strRubricError){let options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const detailed=!!options.detailed,root=options.root||document;if(!Array.isArray(rubricData))return _notification.default.addNotification({message:strRubricError,type:"error"}),!!detailed&&{injected:!1,totalCriteria:0,matchedCriteria:0,fullyAppliedCriteria:0,availableCriteria:[],details:[]};let anyInjected=!1;const allrows=Array.from(root.querySelectorAll("tr.criterion")),visiblerows=allrows.filter((row=>null!==row.offsetParent||row.getClientRects().length>0)),criterionRows=visiblerows.length?visiblerows:allrows,availableCriteria=criterionRows.map((row=>{const descriptionCell=row.querySelector("td.description");return descriptionCell?descriptionCell.textContent.trim():""})).filter((value=>!!value)).slice(0,20),details=[];let matchedCriteria=0,fullyAppliedCriteria=0;if(0===criterionRows.length)return!!detailed&&{injected:!1,totalCriteria:rubricData.length,matchedCriteria:0,fullyAppliedCriteria:0,availableCriteria:availableCriteria,details:rubricData.map((criterionData=>{var _criterionData$levels,_criterionData$levels2,_criterionData$levels3;return{criterion:(null==criterionData?void 0:criterionData.criterion)||"",rowFound:!1,levelFound:!1,levelApplied:!1,commentApplied:!1,expectedPoints:null!==(_criterionData$levels=null==criterionData||null===(_criterionData$levels2=criterionData.levels)||void 0===_criterionData$levels2||null===(_criterionData$levels3=_criterionData$levels2[0])||void 0===_criterionData$levels3?void 0:_criterionData$levels3.points)&&void 0!==_criterionData$levels?_criterionData$levels:null}}))};rubricData.forEach((criterionData=>{const criterionName=criterionData.criterion,targetPoints=criterionData.levels[0].points,comment=criterionData.levels[0].comment,criterionResult={criterion:criterionName,rowFound:!1,levelFound:!1,levelApplied:!1,commentApplied:!1,expectedPoints:targetPoints,selectedPointsBefore:null,selectedPointsAfter:null,radioFound:!1,radioDisabled:!1,mutationAttempted:!1,checkedAfterManualSet:!1,checkedAfterEvents:!1,checkedAfterFallbackClick:!1,classAfterMutation:!1},row=criterionRows.find((rowItem=>{const descriptionCell=rowItem.querySelector("td.description");if(!descriptionCell)return!1;const rowCriterionName=descriptionCell.textContent.trim();return(0,_normalize_string.normalizeString)(rowCriterionName)===(0,_normalize_string.normalizeString)(criterionName)}));if(!row)return void details.push(criterionResult);criterionResult.rowFound=!0,matchedCriteria++;const levelCells=row.querySelectorAll("td.level");levelCells.forEach((levelCell=>{const radioInput=levelCell.querySelector('input[type="radio"]'),isSelected=!(null==radioInput||!radioInput.checked)||levelCell.classList.contains("checked");if(!radioInput||!isSelected)return;const scoreSpan=levelCell.querySelector(".scorevalue");scoreSpan&&(criterionResult.selectedPointsBefore=parseFloat(scoreSpan.textContent.trim()))})),levelCells.forEach((levelCell=>{const scoreSpan=levelCell.querySelector(".scorevalue");if(!scoreSpan)return;const points=parseFloat(scoreSpan.textContent.trim());if(Math.abs(points-targetPoints)>=.1)return;const radioInput=levelCell.querySelector('input[type="radio"]');if(!radioInput)return;criterionResult.levelFound=!0,criterionResult.radioFound=!0,criterionResult.radioDisabled=!!radioInput.disabled;const rowRadios=Array.from(row.querySelectorAll('input[type="radio"]'));if(!radioInput.checked&&!radioInput.disabled){criterionResult.mutationAttempted=!0;const rowLevels=Array.from(row.querySelectorAll("td.level"));rowRadios.forEach((radio=>{const shouldCheck=radio===radioInput;radio.checked=shouldCheck,radio.defaultChecked=shouldCheck,shouldCheck?radio.setAttribute("checked","checked"):radio.removeAttribute("checked")})),criterionResult.checkedAfterManualSet=!!radioInput.checked,rowLevels.forEach((cell=>{const isTarget=cell===levelCell;cell.classList.toggle("checked",isTarget),cell.setAttribute("aria-checked",isTarget?"true":"false")})),criterionResult.classAfterMutation=levelCell.classList.contains("checked"),radioInput.dispatchEvent(new Event("input",{bubbles:!0})),radioInput.dispatchEvent(new Event("change",{bubbles:!0})),criterionResult.checkedAfterEvents=!!radioInput.checked,!radioInput.checked&&radioInput.click&&radioInput.click(),!radioInput.checked&&levelCell.dispatchEvent&&levelCell.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0})),criterionResult.checkedAfterFallbackClick=!!radioInput.checked}(radioInput.checked||levelCell.classList.contains("checked"))&&(criterionResult.levelApplied=!0),radioInput.checked&&(criterionResult.selectedPointsAfter=points)}));const remarkTextarea=row.querySelector("td.remark textarea");remarkTextarea&&comment&&(remarkTextarea.value!==comment&&(remarkTextarea.value=comment,remarkTextarea.dispatchEvent(new Event("input",{bubbles:!0})),remarkTextarea.dispatchEvent(new Event("change",{bubbles:!0}))),criterionResult.commentApplied=remarkTextarea.value===comment),criterionResult.levelApplied&&(anyInjected=!0),!criterionResult.levelApplied||comment&&!criterionResult.commentApplied||fullyAppliedCriteria++,details.push(criterionResult)}));const injected=anyInjected&&fullyAppliedCriteria===rubricData.length;return detailed?{injected:injected,totalCriteria:rubricData.length,matchedCriteria:matchedCriteria,fullyAppliedCriteria:fullyAppliedCriteria,availableCriteria:availableCriteria,details:details}:injected}}));

//# sourceMappingURL=inject_rubric.min.js.map