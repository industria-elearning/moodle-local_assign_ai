{"version":3,"file":"inject_guide.min.js","sources":["../../src/inject_ai/inject_guide.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Injects assessment guide grades and comments.\n *\n * @module      local_assign_ai/inject_ai/inject_guide\n * @copyright   2025 Datacurso\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport { normalizeString } from './normalize_string';\n\n/**\n * Injects assessment guide grades and comments.\n *\n * @param {Object} guideData The guide data object.\n * @returns {boolean} True if guide was injected successfully.\n */\nexport const injectGuide = (guideData) => {\n    let injected = false;\n\n    Object.keys(guideData).forEach(criterionName => {\n        const data = guideData[criterionName];\n        if (!data) {\n            return;\n        }\n\n        const grade = data.grade;\n        let comments = data.reply;\n        if (Array.isArray(comments)) {\n            comments = comments.join(', ');\n        }\n\n        const rows = document.querySelectorAll('tr'); // Broad search for criteria rows\n        rows.forEach(row => {\n            if (!normalizeString(row.textContent).includes(normalizeString(criterionName))) {\n                return;\n            }\n\n            const scoreInput = row.querySelector('.score input[type=\"text\"]');\n            const remarkTextarea = row.querySelector('.remark textarea');\n            let rowUpdated = false;\n\n            if (scoreInput && grade !== undefined && grade !== null) {\n                if (scoreInput.value != grade) {\n                    scoreInput.value = grade;\n                    scoreInput.dispatchEvent(new Event('change', { bubbles: true }));\n                }\n                rowUpdated = true;\n            }\n\n            if (remarkTextarea && comments) {\n                if (remarkTextarea.value !== comments) {\n                    remarkTextarea.value = comments;\n                    remarkTextarea.dispatchEvent(new Event('input', { bubbles: true }));\n                    remarkTextarea.dispatchEvent(new Event('change', { bubbles: true }));\n                }\n                rowUpdated = true;\n            }\n\n            if (rowUpdated) {\n                injected = true;\n            }\n        });\n    });\n\n    return injected;\n};\n"],"names":["guideData","injected","Object","keys","forEach","criterionName","data","grade","comments","reply","Array","isArray","join","document","querySelectorAll","row","textContent","includes","scoreInput","querySelector","remarkTextarea","rowUpdated","value","dispatchEvent","Event","bubbles"],"mappings":"gOA+B4BA,gBACpBC,UAAW,SAEfC,OAAOC,KAAKH,WAAWI,SAAQC,sBACrBC,KAAON,UAAUK,mBAClBC,kBAICC,MAAQD,KAAKC,UACfC,SAAWF,KAAKG,MAChBC,MAAMC,QAAQH,YACdA,SAAWA,SAASI,KAAK,OAGhBC,SAASC,iBAAiB,MAClCV,SAAQW,WACJ,qCAAgBA,IAAIC,aAAaC,UAAS,qCAAgBZ,6BAIzDa,WAAaH,IAAII,cAAc,6BAC/BC,eAAiBL,IAAII,cAAc,wBACrCE,YAAa,EAEbH,YAAAA,MAAcX,QACVW,WAAWI,OAASf,QACpBW,WAAWI,MAAQf,MACnBW,WAAWK,cAAc,IAAIC,MAAM,SAAU,CAAEC,SAAS,MAE5DJ,YAAa,GAGbD,gBAAkBZ,WACdY,eAAeE,QAAUd,WACzBY,eAAeE,MAAQd,SACvBY,eAAeG,cAAc,IAAIC,MAAM,QAAS,CAAEC,SAAS,KAC3DL,eAAeG,cAAc,IAAIC,MAAM,SAAU,CAAEC,SAAS,MAEhEJ,YAAa,GAGbA,aACApB,UAAW,SAKhBA"}