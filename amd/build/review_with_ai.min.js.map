{"version":3,"file":"review_with_ai.min.js","sources":["../src/review_with_ai.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Handles the \"Review with AI\" actions on the assignment review page.\n *\n * @module      local_assign_ai/review_with_ai\n * @copyright   2025 Datacurso\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport { get_string as getString } from 'core/str';\n\n/**\n * Initialize event listeners for AI review buttons.\n */\nexport const init = async () => {\n    // Load localized strings\n    const [\n        strProcessing,\n        strQueued,\n        strProcessed,\n        strNoSubmissions,\n        strReload,\n        strError\n    ] = await Promise.all([\n        getString('processing', 'local_assign_ai'),\n        getString('queued', 'local_assign_ai'),\n        getString('processed', 'local_assign_ai'),\n        getString('nosubmissions', 'local_assign_ai'),\n        getString('reloadpage', 'local_assign_ai'),\n        getString('processingerror', 'local_assign_ai'),\n    ]);\n\n    document.querySelectorAll('.js-review-ai').forEach(button => {\n        button.addEventListener('click', e => {\n            e.preventDefault();\n\n            const cmid = parseInt(button.dataset.cmid);\n            const userid = parseInt(button.dataset.userid || 0);\n            const pendingid = button.dataset.pendingid ? parseInt(button.dataset.pendingid, 10) : 0;\n            const all = button.dataset.all === '1';\n\n            // Save the original HTML to restore it later\n            const originalHTML = button.innerHTML;\n\n            // Show spinner with text\n            button.innerHTML = `\n                <span class=\"spinner-border spinner-border-sm me-2\" role=\"status\" aria-hidden=\"true\"></span>\n                ${strProcessing}\n            `;\n            button.disabled = true;\n\n            // AJAX call to the web service\n            Ajax.call([{\n                methodname: 'local_assign_ai_process_submission',\n                args: { cmid: cmid, userid: userid, all: all, pendingid: pendingid },\n            }])[0].done(result => {\n                if (result.status === 'queued') {\n                    Notification.addNotification({\n                        message: strQueued,\n                        type: 'info',\n                    });\n                    button.innerHTML = originalHTML;\n                    button.disabled = false;\n                    return;\n                }\n\n                if (result.status === 'ok') {\n                    Notification.addNotification({\n                        message: `${strProcessed.replace('{$a}', result.processed)} ${strReload}`,\n                        type: 'success',\n                    });\n                    window.location.reload();\n                    return;\n                }\n\n                Notification.addNotification({\n                    message: strNoSubmissions,\n                    type: 'warning',\n                });\n                button.innerHTML = originalHTML;\n                button.disabled = false;\n            }).fail(err => {\n                Notification.addNotification({\n                    message: strError,\n                    type: 'error',\n                });\n                Notification.exception(err);\n                button.innerHTML = originalHTML;\n                button.disabled = false;\n            });\n        });\n    });\n};\n"],"names":["async","strProcessing","strQueued","strProcessed","strNoSubmissions","strReload","strError","Promise","all","document","querySelectorAll","forEach","button","addEventListener","e","preventDefault","cmid","parseInt","dataset","userid","pendingid","originalHTML","innerHTML","disabled","call","methodname","args","done","result","status","addNotification","message","type","replace","processed","window","location","reload","fail","err","exception"],"mappings":";;;;;;;wLA8BoBA,gBAGZC,cACAC,UACAC,aACAC,iBACAC,UACAC,gBACMC,QAAQC,IAAI,EAClB,mBAAU,aAAc,oBACxB,mBAAU,SAAU,oBACpB,mBAAU,YAAa,oBACvB,mBAAU,gBAAiB,oBAC3B,mBAAU,aAAc,oBACxB,mBAAU,kBAAmB,qBAGjCC,SAASC,iBAAiB,iBAAiBC,SAAQC,SAC/CA,OAAOC,iBAAiB,SAASC,IAC7BA,EAAEC,uBAEIC,KAAOC,SAASL,OAAOM,QAAQF,MAC/BG,OAASF,SAASL,OAAOM,QAAQC,QAAU,GAC3CC,UAAYR,OAAOM,QAAQE,UAAYH,SAASL,OAAOM,QAAQE,UAAW,IAAM,EAChFZ,IAA6B,MAAvBI,OAAOM,QAAQV,IAGrBa,aAAeT,OAAOU,UAG5BV,OAAOU,oJAEDrB,gCAENW,OAAOW,UAAW,gBAGbC,KAAK,CAAC,CACPC,WAAY,qCACZC,KAAM,CAAEV,KAAMA,KAAMG,OAAQA,OAAQX,IAAKA,IAAKY,UAAWA,cACzD,GAAGO,MAAKC,QACc,WAAlBA,OAAOC,8BACMC,gBAAgB,CACzBC,QAAS7B,UACT8B,KAAM,SAEVpB,OAAOU,UAAYD,kBACnBT,OAAOW,UAAW,IAIA,OAAlBK,OAAOC,8BACMC,gBAAgB,CACzBC,kBAAY5B,aAAa8B,QAAQ,OAAQL,OAAOM,uBAAc7B,WAC9D2B,KAAM,iBAEVG,OAAOC,SAASC,iCAIPP,gBAAgB,CACzBC,QAAS3B,iBACT4B,KAAM,YAEVpB,OAAOU,UAAYD,kBACnBT,OAAOW,UAAW,MACnBe,MAAKC,4BACST,gBAAgB,CACzBC,QAASzB,SACT0B,KAAM,gCAEGQ,UAAUD,KACvB3B,OAAOU,UAAYD,aACnBT,OAAOW,UAAW"}